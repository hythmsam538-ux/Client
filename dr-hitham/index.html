<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø·Ù„Ø¨Ø§Øª Ù…Ø®ØªÙ„Ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --danger: #f72585;
            --success: #4ade80;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --radius: 12px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .admin-header {
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding: 20px 0;
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-section img {
            height: 60px;
            filter: drop-shadow(0 2px 10px rgba(76, 201, 240, 0.4));
        }

        .logo-section h1 {
            color: var(--accent);
            font-size: 1.8rem;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background: var(--dark-light);
            color: var(--light);
            border: 1px solid var(--gray);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #be185d);
            color: white;
        }

        /* Stats Cards */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 35px rgba(76, 201, 240, 0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .stat-card h3 {
            font-size: 0.95rem;
            color: var(--gray-light);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .change-up {
            color: var(--success);
        }

        .change-down {
            color: var(--danger);
        }

        /* Country Stats Section */
        .country-stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .country-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .country-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .country-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .country-flag {
            font-size: 2.5rem;
        }

        .country-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent);
        }

        .country-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .saudi-badge {
            background: rgba(0, 104, 56, 0.2);
            color: #00ff88;
            border: 1px solid rgba(0, 104, 56, 0.3);
        }

        .egypt-badge {
            background: rgba(206, 17, 38, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(206, 17, 38, 0.3);
        }

        .country-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .country-stat-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: var(--accent);
            padding-top: 20px;
            margin-top: 10px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .country-stat-label {
            color: var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .country-stat-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Filters Section */
        .filters-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 220px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-light);
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ */
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 12px 15px;
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light) !important;
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        .filter-group select option {
            background: #1e293b !important;
            color: var(--light) !important;
            padding: 12px !important;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
        }

        /* Orders Table */
        .orders-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
        }

        .table-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            background: rgba(15, 23, 42, 0.7);
        }

        .table-header h2 {
            color: var(--accent);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-info {
            color: var(--gray-light);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-info i {
            color: var(--success);
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-content {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        th {
            padding: 18px;
            text-align: right;
            background: rgba(30, 41, 59, 0.9);
            color: var(--accent);
            font-weight: 600;
            font-size: 0.95rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--gray-light);
            font-size: 0.95rem;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Status Badges */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-new {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .status-review {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-shipping {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .status-delivered {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-ready {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Discount Badge */
        .discount-badge {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.3);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 5px;
        }

        /* Payment Status */
        .payment-status-select {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 10px center !important;
            background-size: 10px !important;
            padding-right: 10px !important;
            padding-left: 25px !important;
        }

        .payment-status-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .payment-paid {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border-color: rgba(34, 197, 94, 0.3);
        }

        .payment-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border-color: rgba(245, 158, 11, 0.3);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-view {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .btn-view:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .btn-edit {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .btn-edit:hover {
            background: rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--dark-light);
            border-radius: var(--radius);
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.9);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .modal-header h3 {
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray-light);
            font-size: 28px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            color: var(--accent);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-item strong {
            display: block;
            color: var(--gray-light);
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .info-item span {
            color: white;
            font-weight: 500;
            font-size: 1.05rem;
        }

        .address-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            line-height: 1.6;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ - ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85rem;
            table-layout: fixed;
        }

        .products-table th {
            background: rgba(67, 97, 238, 0.2);
            color: var(--accent);
            padding: 8px 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            text-align: center;
        }

        .products-table td {
            padding: 6px 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-light);
            font-size: 0.75rem;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }

        .products-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* ØªØ­Ø¯ÙŠØ¯ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        .products-table th:nth-child(1),
        .products-table td:nth-child(1) {
            width: 30px;
            padding: 4px 2px;
        }

        .products-table th:nth-child(2),
        .products-table td:nth-child(2) {
            width: 55%;
            text-align: right;
            padding-right: 6px;
        }

        .products-table th:nth-child(3),
        .products-table td:nth-child(3) {
            width: 80px;
            padding: 4px 2px;
        }

        .products-table th:nth-child(4),
        .products-table td:nth-child(4) {
            width: 90px;
            padding: 4px 2px;
        }

        .products-table th:nth-child(5),
        .products-table td:nth-child(5) {
            width: 100px;
            padding: 4px 2px;
        }

        /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Øµ ÙÙŠ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .product-name-cell {
            font-size: 0.8rem;
            line-height: 1.3;
            text-align: right;
            padding-right: 6px;
        }

        .product-name {
            font-size: 0.8rem;
            color: white;
            margin-bottom: 3px;
            display: block;
            line-height: 1.2;
        }

        .product-code {
            font-size: 0.7rem;
            color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block;
            margin-top: 2px;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ù„Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø³Ø¹Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶ */
        .quantity-price-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .quantity-badge {
            background: rgba(76, 201, 240, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.75rem;
            min-width: 25px;
            text-align: center;
        }

        .product-price {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: bold;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .products-section {
            margin-top: 15px;
        }

        .products-container {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.2);
        }

        /* Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø¨ */
        .notes-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .notes-box.empty {
            color: var(--gray-light);
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .order-number {
            font-family: 'Courier New', monospace;
            background: rgba(76, 201, 240, 0.1);
            padding: 5px 12px;
            border-radius: 6px;
            color: var(--accent);
            font-weight: bold;
        }

        /* ØªØ®Ø·ÙŠØ· Ø¬Ø¯ÙŠØ¯ Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ */
        .order-details-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .order-info-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .compact-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .compact-item {
            display: flex;
            flex-direction: column;
        }

        .compact-item strong {
            font-size: 0.8rem;
            color: var(--gray-light);
            margin-bottom: 4px;
        }

        .compact-item span {
            font-size: 0.9rem;
            color: white;
            font-weight: 500;
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        .products-section {
            grid-column: span 2;
        }

        /* Financial Summary */
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .financial-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 12px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.03);
        }

        .financial-item .label {
            font-size: 0.75rem;
            color: var(--gray-light);
            margin-bottom: 6px;
        }

        .financial-item .value {
            font-size: 1rem;
            font-weight: bold;
            color: var(--accent);
        }

        .financial-item.discount .value {
            color: var(--success);
        }

        .financial-item.original .value {
            color: var(--gray-light);
            text-decoration: line-through;
        }

        /* Discount Details */
        .discount-info {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: var(--radius);
            padding: 12px;
            margin-top: 5px;
            font-size: 0.8rem;
        }

        .discount-info .discount-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .discount-info .discount-row:last-child {
            margin-bottom: 0;
            font-weight: bold;
            color: var(--success);
        }

        /* Payment Filter Styling */
        .payment-filter-select {
            padding: 12px 15px;
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light) !important;
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        /* Free Shipping Badge */
        .free-shipping-badge {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 5px;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 50px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header i {
            font-size: 70px;
            color: var(--accent);
            margin-bottom: 25px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .login-header h1 {
            color: white;
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .login-header p {
            color: var(--gray-light);
            font-size: 1.1rem;
        }

        .login-form .form-group {
            margin-bottom: 25px;
        }

        .login-form label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-light);
            font-size: 1rem;
        }

        .login-form input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
        }

        .login-form button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        /* No Data */
        .no-data {
            text-align: center;
            padding: 60px;
            color: var(--gray-light);
        }

        .no-data i {
            font-size: 50px;
            margin-bottom: 20px;
            color: var(--gray);
        }

        .no-data p {
            font-size: 1.1rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--accent);
        }

        .loading i {
            font-size: 40px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        .loading p {
            font-size: 1.1rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
            padding: 20px 25px;
            border-radius: var(--radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.show {
            display: flex;
        }

        .notification i {
            font-size: 24px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 5px;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #be185d);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .country-stats-section {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .admin-info {
                flex-direction: column;
                width: 100%;
            }
            
            .filters-section {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .login-box {
                padding: 30px;
            }
            
            .products-table th,
            .products-table td {
                padding: 5px 3px;
                font-size: 0.7rem;
            }
            
            .products-table th:nth-child(2),
            .products-table td:nth-child(2) {
                width: 45%;
            }
            
            .product-name {
                font-size: 0.75rem;
            }
            
            .product-code {
                font-size: 0.65rem;
                padding: 1px 4px;
            }
            
            .order-details-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .compact-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .products-section {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div class="notification-content">
            <strong id="notificationTitle"></strong>
            <p id="notificationMessage"></p>
        </div>
        <button class="notification-close" onclick="hideNotification()">Ã—</button>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <i class="fas fa-lock"></i>
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
                <p>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="adminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="adminEmail" placeholder="admin@different.com" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="adminPassword" placeholder="********" required>
                </div>
                <button type="submit">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <img src="logo-removebg-preview.png" alt="Ù…Ø®ØªÙ„Ù" onerror="this.src='https://via.placeholder.com/60?text=Logo'">
                        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø·Ù„Ø¨Ø§Øª Ù…Ø®ØªÙ„Ù</h1>
                    </div>
                    <div class="admin-info">
                        <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span id="userEmail">admin@different.com</span>
                        </div>
                        <button class="btn btn-secondary" onclick="refreshOrders()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                        </button>
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Stats Cards -->
            <section class="stats-section">
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(67, 97, 238, 0.2); color: #4361ee;">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-change change-up" id="ordersChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <div class="stat-value" id="newOrders">0</div>
                    <div class="stat-change change-up" id="newOrdersChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
                    <div class="stat-value" id="processingOrders">0</div>
                    <div class="stat-change change-up" id="processingChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(168, 85, 247, 0.2); color: #a855f7;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</h3>
                    <div class="stat-value" id="readyOrders">0</div>
                    <div class="stat-change change-up" id="readyChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù† -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">
                        <i class="fas fa-truck"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</h3>
                    <div class="stat-value" id="shippingOrders">0</div>
                    <div class="stat-change change-up" id="shippingChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù„Ù…Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ù„Ù…Ø©</h3>
                    <div class="stat-value" id="deliveredOrders">0</div>
                    <div class="stat-change change-up" id="deliveredChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(0, 104, 56, 0.2); color: #00ff88;">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h3>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
                    <div class="stat-value" id="saudiProductSum">0 Ø±.Ø³</div>
                    <div class="stat-change change-up" id="saudiProductSumChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØµØ± -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(206, 17, 38, 0.2); color: #ff6b6b;">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h3>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØµØ±</h3>
                    <div class="stat-value" id="egyptProductSum">0 Ø¬.Ù…</div>
                    <div class="stat-change change-up" id="egyptProductSumChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(0, 104, 56, 0.2); color: #00ff88;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
                    <div class="stat-value" id="saudiTotalRevenue">0 Ø±.Ø³</div>
                    <div class="stat-change change-up" id="saudiTotalRevenueChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØµØ± -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(206, 17, 38, 0.2); color: #ff6b6b;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…ØµØ±</h3>
                    <div class="stat-value" id="egyptTotalRevenue">0 Ø¬.Ù…</div>
                    <div class="stat-change change-up" id="egyptTotalRevenueChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ… -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(74, 222, 128, 0.2); color: #4ade80;">
                        <i class="fas fa-tag"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</h3>
                    <div class="stat-value" id="discountOrders">0</div>
                    <div class="stat-change change-up" id="discountChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ± Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ±</h3>
                    <div class="stat-value" id="totalSavings">0</div>
                    <div class="stat-change change-up" id="savingsChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
            </section>

            <!-- Country Statistics -->
            <section class="country-stats-section">
                <!-- Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© -->
                <div class="country-stat-card">
                    <div class="country-header">
                        <div class="country-title">
                            <div class="country-flag">ğŸ‡¸ğŸ‡¦</div>
                            <div>
                                <div class="country-name">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                                <div style="font-size: 0.9rem; color: var(--gray-light);">SAR - Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                            </div>
                        </div>
                        <div class="country-badge saudi-badge">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="saudiOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-calculator"></i>
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="saudiProductSum2">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-truck"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†</span>
                        </div>
                        <div class="country-stat-value" id="saudiShippingRevenue">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                        </div>
                        <div class="country-stat-value" id="saudiTotalRevenue2">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-tag"></i>
                            <span>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</span>
                        </div>
                        <div class="country-stat-value" id="saudiDiscountOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-users"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        </div>
                        <div class="country-stat-value" id="saudiCustomers">0</div>
                    </div>
                </div>
                
                <!-- Ù…ØµØ± -->
                <div class="country-stat-card">
                    <div class="country-header">
                        <div class="country-title">
                            <div class="country-flag">ğŸ‡ªğŸ‡¬</div>
                            <div>
                                <div class="country-name">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                                <div style="font-size: 0.9rem; color: var(--gray-light);">EGP - Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</div>
                            </div>
                        </div>
                        <div class="country-badge egypt-badge">Ù…ØµØ±</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="egyptOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-calculator"></i>
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="egyptProductSum2">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-truck"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†</span>
                        </div>
                        <div class="country-stat-value" id="egyptShippingRevenue">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                        </div>
                        <div class="country-stat-value" id="egyptTotalRevenue2">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-tag"></i>
                            <span>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</span>
                        </div>
                        <div class="country-stat-value" id="egyptDiscountOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-users"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        </div>
                        <div class="country-stat-value" id="egyptCustomers">0</div>
                    </div>
                </div>
            </section>

            <!-- Filters -->
            <section class="filters-section">
                <div class="filter-group">
                    <label for="filterCountry"><i class="fas fa-globe"></i> Ø§Ù„Ø¨Ù„Ø¯</label>
                    <select id="filterCountry">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø¯Ø§Ù†</option>
                        <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                        <option value="Ù…ØµØ±">Ù…ØµØ±</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterStatus"><i class="fas fa-tag"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                    <select id="filterStatus">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                        <option value="Ø¬Ø§Ù‡Ø²">Ø¬Ø§Ù‡Ø²</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†">Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</option>
                        <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                        <option value="Ù…Ù„ØºÙŠ">Ù…Ù„ØºÙŠ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterPayment"><i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="filterPayment">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="bank-transfer">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                        <option value="stc-pay">STC Pay</option>
                        <option value="vodafone-cash">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                        <option value="instapay">Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ</option>
                        <option value="cod">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterPaymentStatus"><i class="fas fa-money-bill-wave"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="filterPaymentStatus" class="payment-filter-select">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="paid">ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="pending">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterDiscount"><i class="fas fa-tag"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…</label>
                    <select id="filterDiscount">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="with-discount">Ù…Ø¹ Ø®ØµÙ…</option>
                        <option value="without-discount">Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="searchOrders"><i class="fas fa-search"></i> Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…</label>
                    <input type="text" id="searchOrders" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ...">
                </div>
            </section>

            <!-- Orders Table -->
            <section class="orders-container">
                <div class="table-header">
                    <h2><i class="fas fa-list-ol"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                    <div class="refresh-info">
                        <i class="fas fa-sync-alt"></i>
                        <span id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: --:--</span>
                    </div>
                </div>
                
                <div class="table-content">
                    <div id="loading" class="loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                    </div>
                    
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ø¨Ù„Ø¯</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                <th>Ø§Ù„Ø®ØµÙ…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody">
                            <tr>
                                <td colspan="14" class="no-data">
                                    <i class="fas fa-shopping-cart"></i>
                                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Order Details Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Status Edit Modal -->
    <div class="modal-overlay" id="statusModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeStatusModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="statusModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Notes Modal -->
    <div class="modal-overlay" id="notesModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
                <button class="modal-close" onclick="closeNotesModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="notesModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const firebaseConfig = {
            apiKey: "AIzaSyBEKzQ_S_WRMLWLHk8fLTrIjrN4bvbYb0",
            authDomain: "different-store-admin.firebaseapp.com",
            projectId: "different-store-admin",
            storageBucket: "different-store-admin.firebasestorage.app",
            messagingSenderId: "75347854869d",
            appId: "1:75347854869d:web:044088f5cf63bf3c74c10b"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let db;
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let allOrders = [];
        let currentUser = null;
        let currentFilteredOrders = [];
        let autoRefreshInterval = null;
        let deletedOrders = new Set();

        // ========================= ğŸ”§ **Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙˆØ§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø©** =========================
        function processSaudiAndEgyptOrders(orders) {
            console.log('ğŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª...');
            
            return orders.map(order => {
                try {
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ù„Ø¯
                    let country = order.customer?.address?.country || 
                                 order.customer?.country || 
                                 order.country || 
                                 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„Ø©
                    let currency = 'Ø±.Ø³';
                    if (country === 'Ù…ØµØ±') {
                        currency = 'Ø¬.Ù…';
                    }
                    
                    // ===== **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø©** =====
                    let orderNumber = order.orderNumber || order.orderId || '---';
                    let createdAt = order.createdAt || new Date().toISOString();
                    let customer = order.customer || {};
                    let address = customer.address || {};
                    let items = Array.isArray(order.items) ? order.items : [];
                    let discount = order.discount || {};
                    let payment = order.payment || {};
                    let notes = order.notes || '';
                    let total = order.total || 0;
                    let subtotal = order.subtotal || 0;
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 1: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**
                    if (items.length === 0) {
                        if (order.products && Array.isArray(order.products)) {
                            items = order.products.map(product => ({
                                name: product.name || 'Ù…Ù†ØªØ¬',
                                code: product.code || product.productCode || product.sku || '',
                                price: product.price || 0,
                                quantity: product.quantity || 1,
                                originalName: product.name || 'Ù…Ù†ØªØ¬'
                            }));
                        }
                    }
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 2: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ±Ù‚Ù…Ù‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„**
                    items = items.map(item => {
                        let name = item.name || item.originalName || 'Ù…Ù†ØªØ¬';
                        let code = item.code || item.productCode || item.sku || '';
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ù†ÙØµÙ„Ù‡ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
                        if (name.includes('(') && name.includes(')')) {
                            const match = name.match(/\(([^)]+)\)/);
                            if (match) {
                                code = match[1];
                                // Ù†ØªØ±Ùƒ Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù…
                            }
                        }
                        
                        return {
                            name: name,
                            code: code,
                            price: item.price || 0,
                            quantity: item.quantity || 1,
                            originalName: item.originalName || name
                        };
                    });
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**
                    let discountApplied = discount.applied || false;
                    let discountAmount = discount.amount || 0;
                    let discountCode = discount.code || '';
                    let discountPercentage = discount.percentage || 0;
                    
                    // **ØªØ­Ø¯ÙŠØ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯**
                    if (discountCode === 'DIFSA10') {
                        discountPercentage = 50; // Ø®ØµÙ… 50% Ù„ÙƒÙˆØ¯ DIFSA10
                    } else if (discountCode === 'DIFSA20') {
                        discountPercentage = 20; // Ø®ØµÙ… 20% Ù„ÙƒÙˆØ¯ DIFSA20
                    }
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 4: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**
                    // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©
                    let productSum = 0;
                    items.forEach(item => {
                        productSum += (item.price || 0) * (item.quantity || 1);
                    });
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø³Ø¹Ø± ÙØ±Ø¹ÙŠ Ù…Ø­Ø¯Ø¯ØŒ Ù†Ø³ØªØ®Ø¯Ù…Ù‡
                    if (subtotal > 0) {
                        productSum = subtotal;
                    }
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 5: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©**
                    if (discountApplied && discountPercentage > 0 && discountAmount === 0) {
                        discountAmount = productSum * (discountPercentage / 100);
                    }
                    
                    let productSumAfterDiscount = productSum - discountAmount;
                    if (productSumAfterDiscount < 0) {
                        productSumAfterDiscount = 0;
                    }
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 6: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø­Ù† Ø§Ù„ØµØ­ÙŠØ­**
                    let shippingCost = order.shippingCost || 0;
                    let freeShipping = discount.freeShipping || false;
                    
                    if (country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                        shippingCost = shippingCost || 25;
                    } else if (country === 'Ù…ØµØ±') {
                        shippingCost = shippingCost || 55;
                    }
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ
                    if (freeShipping) {
                        shippingCost = 0;
                    }
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 7: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ**
                    let finalTotal = total || (productSumAfterDiscount + shippingCost);
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 8: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø¯ÙØ¹**
                    let status = order.status || 'Ø¬Ø¯ÙŠØ¯';
                    let paymentStatus = order.paymentStatus || 'pending';
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 9: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©**
                    let governorate = address.governorate || customer.governorate || address.city || customer.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    let city = address.city || customer.city || address.region || customer.region || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    let detailedAddress = address.details || customer.address || address.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    
                    // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 10: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹**
                    let paymentMethod = payment.method || 'cod';
                    
                    // **Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©**
                    let additionalNotes = order.additionalNotes || '';
                    if (additionalNotes) {
                        notes = notes ? `${notes}\n\n${additionalNotes}` : additionalNotes;
                    }
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬
                    return {
                        id: order.id || orderNumber,
                        firebaseId: order.id,
                        orderId: orderNumber,
                        orderNumber: orderNumber,
                        createdAt: createdAt,
                        customer: {
                            name: customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±',
                            phone: customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                            email: customer.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                            country: country,
                            address: {
                                country: country,
                                governorate: governorate,
                                city: city,
                                details: detailedAddress
                            }
                        },
                        items: items,
                        payment: {
                            method: paymentMethod,
                            status: payment.status || 'pending'
                        },
                        paymentStatus: paymentStatus,
                        status: status,
                        notes: notes,
                        totals: {
                            subtotal: productSum,
                            shipping: shippingCost,
                            total: finalTotal,
                            currency: currency
                        },
                        discount: {
                            applied: discountApplied,
                            code: discountCode,
                            amount: discountAmount,
                            percentage: discountPercentage,
                            originalTotal: productSum + shippingCost,
                            finalTotal: finalTotal,
                            description: discountApplied ? 
                                (discountCode === 'DIFSA10' ? 'Ø®ØµÙ… 50%' : 
                                 discountCode === 'DIFSA20' ? 'Ø®ØµÙ… 20%' : 
                                 'Ø®ØµÙ…') : 
                                'Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…',
                            discountValue: discountPercentage,
                            freeShipping: freeShipping,
                            quantity: items.reduce((sum, item) => sum + (item.quantity || 1), 0)
                        },
                        shippingCost: shippingCost,
                        source: order.source || 'firebase',
                        paymentUpdatedAt: order.paymentUpdatedAt,
                        statusUpdatedAt: order.statusUpdatedAt
                    };
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨:', error);
                    console.log('Ø·Ù„Ø¨ Ø¨Ù‡ Ù…Ø´ÙƒÙ„Ø©:', order);
                    return null;
                }
            }).filter(order => order !== null);
        }

        // ========================= ğŸ”§ **Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©** =========================
        async function loadOrders() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...');
            
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('ordersBody').innerHTML = `
                    <tr>
                        <td colspan="14" style="text-align: center; padding: 50px;">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                            </div>
                        </td>
                    </tr>
                `;
                
                // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                const deleted = JSON.parse(localStorage.getItem('deleted_orders')) || [];
                deletedOrders = new Set(deleted);
                console.log(`ğŸ—‘ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©: ${deletedOrders.size}`);
                
                let firebaseOrders = [];
                let localOrders = [];
                
                // 2. ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase
                try {
                    console.log('ğŸ”¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Firebase...');
                    
                    const queries = [
                        db.collection('orders').orderBy('createdAt', 'desc').limit(100),
                        db.collection('orders').orderBy('orderNumber', 'desc').limit(100),
                        db.collection('orders').orderBy('orderId', 'desc').limit(100)
                    ];
                    
                    let combinedResults = [];
                    
                    for (let query of queries) {
                        try {
                            const snapshot = await query.get();
                            snapshot.forEach(doc => {
                                const data = doc.data();
                                data.id = doc.id;
                                data.firebaseId = doc.id;
                                data.source = 'firebase';
                                
                                const orderKey = data.orderNumber || data.orderId || doc.id;
                                if (!deletedOrders.has(orderKey.toString())) {
                                    combinedResults.push(data);
                                }
                            });
                        } catch (queryError) {
                            console.warn('âš ï¸ Ø§Ø³ØªØ¹Ù„Ø§Ù… Firebase ÙØ´Ù„:', queryError.message);
                        }
                    }
                    
                    firebaseOrders = Array.from(new Map(combinedResults.map(order => 
                        [order.orderNumber || order.orderId || order.id, order]
                    )).values());
                    
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${firebaseOrders.length} Ø·Ù„Ø¨ Ù…Ù† Firebase`);
                    
                } catch (firebaseError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', firebaseError);
                }
                
                // 3. ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
                try {
                    console.log('ğŸ’¾ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† localStorage...');
                    
                    const savedOrders = JSON.parse(localStorage.getItem('orders')) || [];
                    const savedNewOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                    
                    [...savedOrders, ...savedNewOrders].forEach(order => {
                        const orderKey = order.orderNumber || order.orderId || order.id;
                        
                        if (orderKey && !deletedOrders.has(orderKey.toString())) {
                            order.source = 'local';
                            localOrders.push(order);
                        }
                    });
                    
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${localOrders.length} Ø·Ù„Ø¨ Ù…Ù† localStorage`);
                    
                } catch (localError) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage:', localError);
                }
                
                // 4. Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                let allOrdersRaw = [...firebaseOrders, ...localOrders];
                console.log(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${allOrdersRaw.length}`);
                
                // 5. **Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙˆØ§Ù„Ù…ØµØ±ÙŠØ©**
                const processedOrders = processSaudiAndEgyptOrders(allOrdersRaw);
                
                // 6. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                const orderMap = new Map();
                processedOrders.forEach(order => {
                    const key = order.orderNumber || order.orderId || order.id;
                    if (key && !orderMap.has(key)) {
                        orderMap.set(key, order);
                    }
                });
                
                allOrders = Array.from(orderMap.values())
                    .sort((a, b) => {
                        const dateA = new Date(a.createdAt || 0);
                        const dateB = new Date(b.createdAt || 0);
                        return dateB - dateA;
                    });
                
                console.log(`ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø·Ù„Ø¨ (${allOrders.filter(o => 
                    o.customer?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' || 
                    o.customer?.address?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'
                ).length} Ø³Ø¹ÙˆØ¯ÙŠØŒ ${allOrders.filter(o => 
                    o.customer?.country === 'Ù…ØµØ±' || 
                    o.customer?.address?.country === 'Ù…ØµØ±'
                ).length} Ù…ØµØ±ÙŠ)`);
                
                // 7. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateAllStats(allOrders);
                
                // 8. Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                displayOrders(allOrders);
                
                // 9. ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                updateLastUpdateTime();
                
                document.getElementById('loading').style.display = 'none';
                
                // 10. Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                if (allOrders.length > 0) {
                    const saudiCount = allOrders.filter(o => 
                        o.customer?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' || 
                        o.customer?.address?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'
                    ).length;
                    const egyptCount = allOrders.filter(o => 
                        o.customer?.country === 'Ù…ØµØ±' || 
                        o.customer?.address?.country === 'Ù…ØµØ±'
                    ).length;
                    
                    showNotification('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 
                        `${allOrders.length} Ø·Ù„Ø¨ (${saudiCount} Ø³Ø¹ÙˆØ¯ÙŠØŒ ${egyptCount} Ù…ØµØ±ÙŠ)`,
                        'success'
                    );
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                document.getElementById('loading').style.display = 'none';
                
                document.getElementById('ordersBody').innerHTML = `
                    <tr>
                        <td colspan="14" class="no-data">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                            <p>${error.message}</p>
                            <button class="btn btn-secondary" onclick="loadOrders()" style="margin-top: 20px;">
                                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </td>
                    </tr>
                `;
                
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', error.message, 'error');
            }
        }

        // ========================= ğŸ”§ **Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª** =========================
        function updateAllStats(orders) {
            console.log('ğŸ“ˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
            
            const today = new Date().toDateString();
            
            const saudiOrders = orders.filter(order => {
                const country = order.customer?.country || order.customer?.address?.country;
                return country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
            });
            
            const egyptOrders = orders.filter(order => {
                const country = order.customer?.country || order.customer?.address?.country;
                return country === 'Ù…ØµØ±';
            });
            
            const todayOrders = orders.filter(order => {
                const orderDate = new Date(order.createdAt).toDateString();
                return orderDate === today;
            });
            
            const discountOrders = orders.filter(order => 
                order.discount?.applied
            );
            
            const todayDiscountOrders = discountOrders.filter(order => {
                const orderDate = new Date(order.createdAt).toDateString();
                return orderDate === today;
            });
            
            let saudiProductSum = 0;
            let egyptProductSum = 0;
            let saudiShippingRevenue = 0;
            let egyptShippingRevenue = 0;
            let saudiTotalRevenue = 0;
            let egyptTotalRevenue = 0;
            let totalSavings = 0;
            let todaySavings = 0;
            
            let todaySaudiProductSum = 0;
            let todayEgyptProductSum = 0;
            let todaySaudiTotalRevenue = 0;
            let todayEgyptTotalRevenue = 0;
            
            orders.forEach(order => {
                const discount = order.discount || {};
                const totals = order.totals || {};
                const items = order.items || [];
                const country = order.customer?.country || order.customer?.address?.country;
                
                let productSum = totals.subtotal || 0;
                let productSumAfterDiscount = productSum - (discount.amount || 0);
                
                const shippingCost = order.shippingCost || totals.shipping || 0;
                let totalRevenue = totals.total || (productSumAfterDiscount + shippingCost);
                
                if (country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                    saudiProductSum += productSumAfterDiscount;
                    saudiShippingRevenue += shippingCost;
                    saudiTotalRevenue += totalRevenue;
                    
                    const orderDate = new Date(order.createdAt).toDateString();
                    if (orderDate === today) {
                        todaySaudiProductSum += productSumAfterDiscount;
                        todaySaudiTotalRevenue += totalRevenue;
                    }
                } else if (country === 'Ù…ØµØ±') {
                    egyptProductSum += productSumAfterDiscount;
                    egyptShippingRevenue += shippingCost;
                    egyptTotalRevenue += totalRevenue;
                    
                    const orderDate = new Date(order.createdAt).toDateString();
                    if (orderDate === today) {
                        todayEgyptProductSum += productSumAfterDiscount;
                        todayEgyptTotalRevenue += totalRevenue;
                    }
                }
                
                if (discount.applied) {
                    const originalTotal = productSum + shippingCost;
                    const finalTotal = totalRevenue;
                    const orderSavings = originalTotal - finalTotal;
                    
                    if (orderSavings > 0) {
                        totalSavings += orderSavings;
                        
                        const orderDate = new Date(order.createdAt).toDateString();
                        if (orderDate === today) {
                            todaySavings += orderSavings;
                        }
                    }
                }
            });
            
            const processingOrders = orders.filter(order => order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©');
            const readyOrders = orders.filter(order => order.status === 'Ø¬Ø§Ù‡Ø²');
            const shippingOrders = orders.filter(order => order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†');
            const deliveredOrders = orders.filter(order => order.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…');
            const newOrders = orders.filter(order => order.status === 'Ø¬Ø¯ÙŠØ¯');
            
            const saudiCustomers = [...new Set(saudiOrders.map(order => order.customer?.phone))].filter(phone => phone).length;
            const egyptCustomers = [...new Set(egyptOrders.map(order => order.customer?.phone))].filter(phone => phone).length;
            
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('newOrders').textContent = newOrders.length;
            document.getElementById('processingOrders').textContent = processingOrders.length;
            document.getElementById('readyOrders').textContent = readyOrders.length;
            document.getElementById('shippingOrders').textContent = shippingOrders.length;
            document.getElementById('deliveredOrders').textContent = deliveredOrders.length;
            
            document.getElementById('discountOrders').textContent = discountOrders.length;
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings);
            
            document.getElementById('saudiProductSum').textContent = formatCurrency(saudiProductSum) + ' Ø±.Ø³';
            document.getElementById('egyptProductSum').textContent = formatCurrency(egyptProductSum) + ' Ø¬.Ù…';
            
            document.getElementById('saudiTotalRevenue').textContent = formatCurrency(saudiTotalRevenue) + ' Ø±.Ø³';
            document.getElementById('egyptTotalRevenue').textContent = formatCurrency(egyptTotalRevenue) + ' Ø¬.Ù…';
            
            document.getElementById('ordersChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${todayOrders.length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('newOrdersChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${newOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('processingChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${processingOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('readyChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${readyOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('shippingChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${shippingOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('deliveredChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${deliveredOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('discountChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${todayDiscountOrders.length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('savingsChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todaySavings)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('saudiProductSumChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todaySaudiProductSum)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('egyptProductSumChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todayEgyptProductSum)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('saudiTotalRevenueChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todaySaudiTotalRevenue)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('egyptTotalRevenueChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todayEgyptTotalRevenue)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            
            const saudiDiscountOrders = saudiOrders.filter(o => o.discount?.applied);
            document.getElementById('saudiOrders').textContent = saudiOrders.length;
            document.getElementById('saudiProductSum2').textContent = formatCurrency(saudiProductSum) + ' Ø±.Ø³';
            document.getElementById('saudiShippingRevenue').textContent = formatCurrency(saudiShippingRevenue) + ' Ø±.Ø³';
            document.getElementById('saudiTotalRevenue2').textContent = formatCurrency(saudiTotalRevenue) + ' Ø±.Ø³';
            document.getElementById('saudiDiscountOrders').textContent = saudiDiscountOrders.length;
            document.getElementById('saudiCustomers').textContent = saudiCustomers;
            
            const egyptDiscountOrders = egyptOrders.filter(o => o.discount?.applied);
            document.getElementById('egyptOrders').textContent = egyptOrders.length;
            document.getElementById('egyptProductSum2').textContent = formatCurrency(egyptProductSum) + ' Ø¬.Ù…';
            document.getElementById('egyptShippingRevenue').textContent = formatCurrency(egyptShippingRevenue) + ' Ø¬.Ù…';
            document.getElementById('egyptTotalRevenue2').textContent = formatCurrency(egyptTotalRevenue) + ' Ø¬.Ù…';
            document.getElementById('egyptDiscountOrders').textContent = egyptDiscountOrders.length;
            document.getElementById('egyptCustomers').textContent = egyptCustomers;
            
            console.log('ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©:', {
                'Ø·Ù„Ø§Ø¨ Ø³Ø¹ÙˆØ¯ÙŠØ©': saudiOrders.length,
                'Ø·Ù„Ø§Ø¨ Ù…ØµØ±': egyptOrders.length,
                'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø³Ø¹ÙˆØ¯ÙŠØ©': saudiTotalRevenue,
                'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØµØ±': egyptTotalRevenue
            });
        }

        // ========================= ğŸ”§ **ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©** =========================
        function formatCurrency(amount) {
            if (typeof amount !== 'number' || isNaN(amount)) {
                amount = 0;
            }
            return Math.round(amount).toLocaleString('ar-SA');
        }

        // ========================= ğŸ”§ **Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„** =========================
        function displayOrders(orders) {
            console.log('ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„:', orders.length);
            
            const tbody = document.getElementById('ordersBody');
            currentFilteredOrders = orders;
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="14" class="no-data">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            orders.forEach((order, index) => {
                try {
                    const customer = order.customer || {};
                    const address = customer.address || {};
                    const discount = order.discount || {};
                    const items = order.items || [];
                    const totals = order.totals || {};
                    
                    const orderNumber = order.orderNumber || order.orderId || order.id || '---';
                    const orderDate = formatDate(order.createdAt);
                    const customerName = customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±';
                    const country = customer.country || address.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const phone = customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const governorate = address.governorate || customer.governorate || address.city || customer.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const paymentMethod = getPaymentMethodArabic(order.payment?.method);
                    const currency = country === 'Ù…ØµØ±' ? 'Ø¬.Ù…' : 'Ø±.Ø³';
                    const status = order.status || 'Ø¬Ø¯ÙŠØ¯';
                    const paymentStatus = order.paymentStatus || 'pending';
                    
                    let productSum = totals.subtotal || 0;
                    let productSumAfterDiscount = productSum - (discount.amount || 0);
                    
                    const shippingCost = order.shippingCost || totals.shipping || 0;
                    let totalRevenue = totals.total || (productSumAfterDiscount + shippingCost);
                    
                    const hasDiscount = discount.applied || false;
                    const discountAmount = discount.amount || 0;
                    const discountCode = discount.code || '';
                    const discountText = hasDiscount ? 
                        `<span class="discount-badge" title="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…: ${discountCode}">
                            <i class="fas fa-tag"></i> ${formatCurrency(discountAmount)} ${currency}
                        </span>` : 
                        '--';
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong class="order-number">#${orderNumber}</strong></td>
                            <td>${orderDate}</td>
                            <td><strong>${customerName}</strong></td>
                            <td>
                                <span class="country-badge ${country === 'Ù…ØµØ±' ? 'egypt-badge' : 'saudi-badge'}">
                                    ${country}
                                </span>
                            </td>
                            <td>${phone}</td>
                            <td>${governorate}</td>
                            <td><span class="payment-badge">${paymentMethod}</span></td>
                            <td>
                                <select class="payment-status-select ${paymentStatus === 'paid' ? 'payment-paid' : 'payment-pending'}" 
                                        onchange="updatePaymentStatus('${order.id || order.orderId}', this.value, '${orderNumber}')">
                                    <option value="pending" ${paymentStatus === 'pending' ? 'selected' : ''}>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                                    <option value="paid" ${paymentStatus === 'paid' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                                </select>
                            </td>
                            <td><strong style="color: #00ff88; font-weight: bold;">${formatCurrency(totalRevenue)} ${currency}</strong></td>
                            <td><strong style="color: var(--accent);">${formatCurrency(productSumAfterDiscount)} ${currency}</strong></td>
                            <td>${discountText}</td>
                            <td>
                                <span class="status-badge status-${getStatusClass(status)}">
                                    ${status}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn btn-view" onclick="viewOrderDetails('${order.id || order.orderId}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn btn-edit" onclick="editOrderStatusModal('${order.id || order.orderId}')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteOrder('${order.id || order.orderId}', '${orderNumber}')" title="Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                } catch (rowError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØµÙ Ø§Ù„Ø·Ù„Ø¨:', rowError);
                    console.log('Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø°ÙŠ ØªØ³Ø¨Ø¨ ÙÙŠ Ø§Ù„Ø®Ø·Ø£:', order);
                }
            });
            
            tbody.innerHTML = html;
            
            setupFilters();
            
            console.log('âœ… ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„');
        }

        // ========================= ğŸ”§ **ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®** =========================
        function formatDate(dateString) {
            if (!dateString) return '---';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '---';
                
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                
                return `${year}-${month}-${day} ${hours}:${minutes}`;
            } catch (e) {
                console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®:', dateString);
                return '---';
            }
        }

        // ========================= ğŸ”§ **Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©** =========================
        function getPaymentMethodArabic(method) {
            const methods = {
                'bank-transfer': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
                'stc-pay': 'STC Pay',
                'vodafone-cash': 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                'instapay': 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                'cod': 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…'
            };
            return methods[method] || method || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        // ========================= ğŸ”§ **Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø­Ø§Ù„Ø©** =========================
        function getStatusClass(status) {
            const map = {
                'Ø¬Ø¯ÙŠØ¯': 'new',
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©': 'review',
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': 'processing',
                'Ø¬Ø§Ù‡Ø²': 'ready',
                'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†': 'shipping',
                'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…': 'delivered',
                'Ù…Ù„ØºÙŠ': 'cancelled'
            };
            return map[status] || 'new';
        }

        // ========================= ğŸ”§ **Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ±** =========================
        function setupFilters() {
            document.getElementById('filterCountry').addEventListener('change', applyFilters);
            document.getElementById('filterStatus').addEventListener('change', applyFilters);
            document.getElementById('filterPayment').addEventListener('change', applyFilters);
            document.getElementById('filterPaymentStatus').addEventListener('change', applyFilters);
            document.getElementById('filterDiscount').addEventListener('change', applyFilters);
            document.getElementById('searchOrders').addEventListener('input', applyFilters);
        }

        // ========================= ğŸ”§ **ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±** =========================
        function applyFilters() {
            const country = document.getElementById('filterCountry').value;
            const status = document.getElementById('filterStatus').value;
            const payment = document.getElementById('filterPayment').value;
            const paymentStatus = document.getElementById('filterPaymentStatus').value;
            const discount = document.getElementById('filterDiscount').value;
            const search = document.getElementById('searchOrders').value.toLowerCase();
            
            let filtered = allOrders;
            
            if (country) {
                filtered = filtered.filter(order => {
                    const orderCountry = order.customer?.country || order.customer?.address?.country;
                    return orderCountry === country;
                });
            }
            
            if (status) {
                filtered = filtered.filter(order => order.status === status);
            }
            
            if (payment) {
                filtered = filtered.filter(order => order.payment?.method === payment);
            }
            
            if (paymentStatus) {
                filtered = filtered.filter(order => order.paymentStatus === paymentStatus);
            }
            
            if (discount === 'with-discount') {
                filtered = filtered.filter(order => order.discount?.applied);
            } else if (discount === 'without-discount') {
                filtered = filtered.filter(order => !order.discount?.applied);
            }
            
            if (search) {
                filtered = filtered.filter(order => {
                    const searchableText = [
                        order.orderNumber,
                        order.orderId,
                        order.customer?.name,
                        order.customer?.fullName,
                        order.customer?.phone,
                        order.customer?.email,
                        order.discount?.code,
                        order.notes || ''
                    ].filter(text => text).join(' ').toLowerCase();
                    
                    return searchableText.includes(search);
                });
            }
            
            displayOrders(filtered);
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹** =========================
        async function updatePaymentStatus(orderId, paymentStatus, orderNumber) {
            console.log(`ğŸ’³ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø·Ù„Ø¨ #${orderNumber} Ø¥Ù„Ù‰: ${paymentStatus}`);
            
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø®Ø·Ø£', 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            order.paymentStatus = paymentStatus;
            order.paymentUpdatedAt = new Date().toISOString();
            
            if (order.source === 'firebase' && order.firebaseId) {
                try {
                    await db.collection('orders').doc(order.firebaseId).update({
                        paymentStatus: paymentStatus,
                        paymentUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Firebase Ù„Ù„Ø·Ù„Ø¨ #${orderNumber}`);
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Firebase:', error);
                }
            }
            
            updatePaymentInLocalStorage(order);
            
            updateAllStats(allOrders);
            applyFilters();
            
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø·Ù„Ø¨ #${orderNumber}`, 'success');
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ localStorage** =========================
        function updatePaymentInLocalStorage(order) {
            try {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(o => 
                    o.orderNumber == order.orderNumber || 
                    o.orderId == order.orderNumber ||
                    o.id == order.orderNumber
                );
                
                if (orderIndex !== -1) {
                    orders[orderIndex].paymentStatus = order.paymentStatus;
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const newOrderIndex = newOrders.findIndex(o => 
                    o.orderId == order.orderNumber || 
                    o.orderNumber == order.orderNumber ||
                    o.id == order.orderNumber
                );
                
                if (newOrderIndex !== -1) {
                    newOrders[newOrderIndex].paymentStatus = order.paymentStatus;
                    localStorage.setItem('new_orders', JSON.stringify(newOrders));
                }
                
                console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ localStorage Ù„Ù„Ø·Ù„Ø¨ #${order.orderNumber}`);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« localStorage:', error);
            }
        }

        // ========================= ğŸ”§ **ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„** =========================
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (email === 'admin@different.com' && password === 'admin123') {
                currentUser = { email, name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' };
                localStorage.setItem('checkout_admin', JSON.stringify(currentUser));
                showDashboard();
                loadOrders();
                showNotification('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'success');
                startAutoRefresh();
            } else {
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        });

        // ========================= ğŸ”§ **ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚** =========================
        function checkAuth() {
            const savedUser = localStorage.getItem('checkout_admin');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
                loadOrders();
                startAutoRefresh();
                return true;
            }
            return false;
        }

        // ========================= ğŸ”§ **ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬** =========================
        function logout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('checkout_admin');
                currentUser = null;
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                }
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'success');
            }
        }

        // ========================= ğŸ”§ **Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯** =========================
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            if (currentUser) {
                document.getElementById('userEmail').textContent = currentUser.email;
            }
        }

        // ========================= ğŸ”§ **Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ** =========================
        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(() => {
                refreshOrders();
            }, 30000);
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª** =========================
        function refreshOrders() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ...');
            loadOrders();
            updateLastUpdateTime();
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«** =========================
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeString}`;
        }

        // ========================= ğŸ”§ **Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±** =========================
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.className = 'notification';
            if (type === 'error') {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // ========================= ğŸ”§ **Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±** =========================
        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // ========================= ğŸ”§ **Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„** =========================
        function closeModal() {
            document.getElementById('orderModal').classList.remove('show');
        }

        // ========================= ğŸ”§ **Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø©** =========================
        function closeStatusModal() {
            document.getElementById('statusModal').classList.remove('show');
        }

        // ========================= ğŸ”§ **Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª** =========================
        function closeNotesModal() {
            document.getElementById('notesModal').classList.remove('show');
        }

        // ========================= ğŸ”§ **Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø­Ø³Ù†) Ù…Ø¹ Ø²Ø± Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª** =========================
        function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'error');
                return;
            }
            
            const customer = order.customer || {};
            const address = customer.address || {};
            const discount = order.discount || {};
            const items = order.items || [];
            const notes = order.notes || '';
            
            let productSum = order.totals?.subtotal || 0;
            let productSumAfterDiscount = productSum - (discount.amount || 0);
            
            const shippingCost = order.shippingCost || order.totals?.shipping || 0;
            const totalRevenue = order.totals?.total || (productSumAfterDiscount + shippingCost);
            
            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…Ø¶ØºÙˆØ· Ù…Ø¹ Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø³Ø¹Ø± Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨
            const productsHtml = items.map((item, index) => `
                <tr>
                    <td style="text-align: center; width: 30px; padding: 4px 2px;">${index + 1}</td>
                    <td class="product-name-cell">
                        <div class="product-name">
                            <strong>${item.name || 'Ù…Ù†ØªØ¬'}</strong>
                        </div>
                        ${item.code ? `<div class="product-code">${item.code}</div>` : ''}
                    </td>
                    <td style="text-align: center; width: 80px; padding: 4px 2px;">
                        <div class="quantity-price-container">
                            <span class="quantity-badge">${item.quantity || 1}</span>
                            <span class="product-price">Ã—</span>
                            <span class="product-price">${formatCurrency(item.price || 0)} ${order.totals?.currency || 'Ø±.Ø³'}</span>
                        </div>
                    </td>
                    <td style="text-align: center; width: 90px; padding: 4px 2px;">
                        <div class="product-price"><strong>${formatCurrency((item.price || 0) * (item.quantity || 1))} ${order.totals?.currency || 'Ø±.Ø³'}</strong></div>
                    </td>
                    <td style="text-align: center; width: 100px; padding: 4px 2px;">
                        <div class="product-price"><strong>${formatCurrency((item.price || 0) * (item.quantity || 1))} ${order.totals?.currency || 'Ø±.Ø³'}</strong></div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--gray-light); font-size: 0.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
            
            const modalContent = `
                <div class="order-details-layout">
                    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
                    <div class="order-info-column">
                        <div class="info-section">
                            <h4 class="section-title"><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                            <div class="compact-grid">
                                <div class="compact-item">
                                    <strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</strong>
                                    <span class="order-number">#${order.orderNumber || order.id}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</strong>
                                    <span>${formatDate(order.createdAt)}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</strong>
                                    <span class="status-badge status-${getStatusClass(order.status)}">
                                        ${order.status || 'Ø¬Ø¯ÙŠØ¯'}
                                    </span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</strong>
                                    <span class="status-badge ${order.paymentStatus === 'paid' ? 'status-delivered' : 'status-review'}">
                                        ${order.paymentStatus === 'paid' ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹'}
                                    </span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</strong>
                                    <span>${getPaymentMethodArabic(order.payment?.method)}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø§Ù„Ø¨Ù„Ø¯</strong>
                                    <span class="country-badge ${customer.country === 'Ù…ØµØ±' ? 'egypt-badge' : 'saudi-badge'}">
                                        ${customer.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                    </span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</strong>
                                    <span>${address.governorate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</strong>
                                    <span>${address.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-section">
                            <h4 class="section-title"><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                            <div class="compact-grid">
                                <div class="compact-item">
                                    <strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</strong>
                                    <span>${customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±'}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø§Ù„Ù‡Ø§ØªÙ</strong>
                                    <span>${customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                                <div class="compact-item">
                                    <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</strong>
                                    <span>${customer.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                            </div>
                            <div class="compact-item" style="grid-column: span 2; margin-top: 10px;">
                                <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</strong>
                                <div class="address-box" style="margin-top: 5px; font-size: 0.85rem; padding: 10px;">
                                    ${address.details || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                    <div class="order-info-column">
                        <div class="info-section" style="height: 100%;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 class="section-title" style="margin: 0;"><i class="fas fa-shopping-bag"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${items.length})</h4>
                                <button class="btn btn-secondary" onclick="editOrderNotes('${order.id || order.orderId}')" style="padding: 8px 15px; font-size: 0.85rem;">
                                    <i class="fas fa-edit"></i> ${notes ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©'}
                                </button>
                            </div>
                            
                            <div class="products-container">
                                <table class="products-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                                            <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ã— Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${productsHtml}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <h4 class="section-title" style="font-size: 1rem; margin-bottom: 10px;">
                                    <i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø¨
                                    <button class="btn btn-secondary" onclick="editOrderNotes('${order.id || order.orderId}')" style="padding: 6px 12px; font-size: 0.8rem; margin-right: 10px;">
                                        <i class="fas fa-edit"></i> ${notes ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø¥Ø¶Ø§ÙØ©'}
                                    </button>
                                </h4>
                                <div class="notes-box ${!notes ? 'empty' : ''}" style="margin-top: 5px;">
                                    ${notes ? notes : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ø´Ø­Ù† -->
                <div class="info-section" style="margin-top: 20px;">
                    <h4 class="section-title"><i class="fas fa-calculator"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h4>
                    
                    ${discount.applied ? `
                    <div class="discount-info">
                        <div class="discount-row">
                            <span>ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:</span>
                            <span><strong>${discount.code || 'Ø¨Ø¯ÙˆÙ† ÙƒÙˆØ¯'}</strong></span>
                        </div>
                        <div class="discount-row">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…:</span>
                            <span><strong>${discount.discountValue || discount.percentage || 0}%</strong></span>
                        </div>
                        <div class="discount-row">
                            <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…:</span>
                            <span><strong>${formatCurrency(discount.amount || 0)} ${order.totals?.currency || 'Ø±.Ø³'}</strong></span>
                        </div>
                        <div class="discount-row">
                            <span>Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                            <span>
                                ${discount.freeShipping ? 
                                    '<span class="free-shipping-badge"><i class="fas fa-truck"></i> Ù…Ø¬Ø§Ù†ÙŠ</span>' : 
                                    `${formatCurrency(shippingCost)} ${order.totals?.currency || 'Ø±.Ø³'}`}
                            </span>
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="financial-summary">
                        <div class="financial-item">
                            <span class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                            <span class="value">${formatCurrency(productSum)} ${order.totals?.currency || 'Ø±.Ø³'}</span>
                        </div>
                        <div class="financial-item">
                            <span class="label">Ø§Ù„Ø´Ø­Ù†</span>
                            <span class="value">
                                ${discount.freeShipping ? 
                                    '<span style="color: #3b82f6;"><i class="fas fa-truck"></i> Ù…Ø¬Ø§Ù†ÙŠ</span>' : 
                                    `${formatCurrency(shippingCost)} ${order.totals?.currency || 'Ø±.Ø³'}`}
                            </span>
                        </div>
                        ${discount.applied ? `
                        <div class="financial-item discount">
                            <span class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…</span>
                            <span class="value">-${formatCurrency(discount.amount || 0)} ${order.totals?.currency || 'Ø±.Ø³'}</span>
                        </div>
                        <div class="financial-item original">
                            <span class="label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…</span>
                            <span class="value">${formatCurrency(productSum + shippingCost)} ${order.totals?.currency || 'Ø±.Ø³'}</span>
                        </div>
                        ` : ''}
                        <div class="financial-item" style="grid-column: span 2; background: rgba(67, 97, 238, 0.1);">
                            <span class="label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                            <span class="value" style="color: #00ff88; font-size: 1.3rem;">
                                ${formatCurrency(totalRevenue)} ${order.totals?.currency || 'Ø±.Ø³'}
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <div style="display: flex; gap: 15px; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="btn btn-edit" onclick="editOrderStatusModal('${order.id || order.orderId}')" style="flex: 1;">
                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                    </button>
                    <button class="btn btn-secondary" onclick="editOrderNotes('${order.id || order.orderId}')" style="flex: 1;">
                        <i class="fas fa-edit"></i> ${notes ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©'}
                    </button>
                    <button class="btn btn-danger" onclick="deleteOrder('${order.id || order.orderId}', '${order.orderNumber || order.id}')" style="flex: 1;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨
                    </button>
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('orderModal').classList.add('show');
        }

        // ========================= ğŸ”§ **ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø·Ù„Ø¨** =========================
        function editOrderNotes(orderId) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'error');
                return;
            }
            
            const customer = order.customer || {};
            const orderNumber = order.orderNumber || order.id;
            const currentNotes = order.notes || '';
            
            const modalContent = `
                <div style="padding: 20px;">
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong>
                        <span class="order-number">#${orderNumber}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong>
                        <span style="font-size: 1.1rem;">${customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±'}</span>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="orderNotes" style="display: block; margin-bottom: 10px; color: var(--light);">
                            <i class="fas fa-sticky-note"></i> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:
                        </label>
                        <textarea id="orderNotes" rows="6" style="width: 100%; padding: 12px; border-radius: 8px; background: #1e293b; border: 1px solid rgba(255,255,255,0.2); color: white; resize: vertical; font-family: inherit;" 
                                  placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨ Ù‡Ù†Ø§...">${currentNotes}</textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-secondary" onclick="closeNotesModal()" style="flex: 1;">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button class="btn btn-success" onclick="saveOrderNotes('${order.id || order.orderId}')" style="flex: 1;">
                            <i class="fas fa-check"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('notesModalContent').innerHTML = modalContent;
            document.getElementById('notesModal').classList.add('show');
        }

        // ========================= ğŸ”§ **Ø­ÙØ¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø·Ù„Ø¨** =========================
        async function saveOrderNotes(orderId) {
            const notes = document.getElementById('orderNotes').value;
            
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø®Ø·Ø£', 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            order.notes = notes;
            
            if (order.source === 'firebase' && order.firebaseId) {
                try {
                    await db.collection('orders').doc(order.firebaseId).update({
                        notes: notes
                    });
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø·Ù„Ø¨:', error);
                }
            }
            
            updateNotesInLocalStorage(order);
            closeNotesModal();
            closeModal();
            showNotification('ØªÙ… Ø§Ù„Ø­ÙØ¸', `ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø·Ù„Ø¨ #${order.orderNumber || order.id}`, 'success');
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ localStorage** =========================
        function updateNotesInLocalStorage(order) {
            try {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(o => 
                    o.orderNumber == order.orderNumber || 
                    o.orderId == order.orderNumber
                );
                if (orderIndex !== -1) {
                    orders[orderIndex].notes = order.notes;
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const newOrderIndex = newOrders.findIndex(o => 
                    o.orderId == order.orderNumber || 
                    o.orderNumber == order.orderNumber
                );
                if (newOrderIndex !== -1) {
                    newOrders[newOrderIndex].notes = order.notes;
                    localStorage.setItem('new_orders', JSON.stringify(newOrders));
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ localStorage:', error);
            }
        }

        // ========================= ğŸ”§ **ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨** =========================
        function editOrderStatusModal(orderId) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'error');
                return;
            }
            
            const customer = order.customer || {};
            const customerName = customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±';
            const orderNumber = order.orderNumber || order.id;
            
            const modalContent = `
                <div style="padding: 20px;">
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong>
                        <span class="order-number">#${orderNumber}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong>
                        <span style="font-size: 1.1rem;">${customerName}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 30px;">
                        <strong style="display: block; margin-bottom: 15px; color: var(--accent);">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong>
                        <span class="status-badge status-${getStatusClass(order.status)}" style="font-size: 1rem;">
                            ${order.status || 'Ø¬Ø¯ÙŠØ¯'}
                        </span>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="newStatus" style="display: block; margin-bottom: 10px; color: var(--light);">
                            <i class="fas fa-edit"></i> Ø­Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
                        </label>
                        <select id="newStatus" style="width: 100%; padding: 12px; border-radius: 8px; background: #1e293b; border: 1px solid rgba(255,255,255,0.2); color: white;">
                            <option value="Ø¬Ø¯ÙŠØ¯" ${order.status === 'Ø¬Ø¯ÙŠØ¯' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="Ø¬Ø§Ù‡Ø²" ${order.status === 'Ø¬Ø§Ù‡Ø²' ? 'selected' : ''}>Ø¬Ø§Ù‡Ø²</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</option>
                            <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" ${order.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                            <option value="Ù…Ù„ØºÙŠ" ${order.status === 'Ù…Ù„ØºÙŠ' ? 'selected' : ''}>Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-secondary" onclick="closeStatusModal()" style="flex: 1;">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button class="btn btn-success" onclick="updateOrderStatus('${order.id || order.orderId}')" style="flex: 1;">
                            <i class="fas fa-check"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('statusModalContent').innerHTML = modalContent;
            document.getElementById('statusModal').classList.add('show');
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨** =========================
        async function updateOrderStatus(orderId) {
            const newStatus = document.getElementById('newStatus').value;
            
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø®Ø·Ø£', 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            order.status = newStatus;
            order.statusUpdatedAt = new Date().toISOString();
            
            if (order.source === 'firebase' && order.firebaseId) {
                try {
                    await db.collection('orders').doc(order.firebaseId).update({
                        status: newStatus,
                        statusUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:', error);
                }
            }
            
            updateOrderInLocalStorage(order);
            closeStatusModal();
            updateAllStats(allOrders);
            displayOrders(currentFilteredOrders);
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ #${order.orderNumber || order.id} Ø¥Ù„Ù‰ "${newStatus}"`, 'success');
        }

        // ========================= ğŸ”§ **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ localStorage** =========================
        function updateOrderInLocalStorage(order) {
            try {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(o => 
                    o.orderNumber == order.orderNumber || 
                    o.orderId == order.orderNumber
                );
                if (orderIndex !== -1) {
                    orders[orderIndex].status = order.status;
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const newOrderIndex = newOrders.findIndex(o => 
                    o.orderId == order.orderNumber || 
                    o.orderNumber == order.orderNumber
                );
                if (newOrderIndex !== -1) {
                    newOrders[newOrderIndex].status = order.status;
                    localStorage.setItem('new_orders', JSON.stringify(newOrders));
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« localStorage:', error);
            }
        }

        // ========================= ğŸ”§ **Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨** =========================
        async function deleteOrder(orderId, orderNumber) {
            if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber}ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                return;
            }
            
            try {
                deletedOrders.add(orderNumber.toString());
                localStorage.setItem('deleted_orders', JSON.stringify(Array.from(deletedOrders)));
                
                const order = allOrders.find(o => o.id === orderId || o.orderId === orderNumber);
                
                if (order && order.source === 'firebase' && order.firebaseId) {
                    try {
                        await db.collection('orders').doc(order.firebaseId).delete();
                    } catch (firebaseError) {
                        console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Firebase:', firebaseError);
                    }
                }
                
                allOrders = allOrders.filter(o => 
                    o.id !== orderId && 
                    o.orderId !== orderNumber && 
                    o.orderNumber !== orderNumber
                );
                
                currentFilteredOrders = currentFilteredOrders.filter(o => 
                    o.id !== orderId && 
                    o.orderId !== orderNumber && 
                    o.orderNumber !== orderNumber
                );
                
                updateAllStats(allOrders);
                displayOrders(currentFilteredOrders);
                
                closeModal();
                closeStatusModal();
                closeNotesModal();
                
                showNotification('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù', error.message, 'error');
            }
        }

        // ========================= ğŸ”§ **ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel** =========================
        function exportToExcel() {
            if (allOrders.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§', 'error');
                return;
            }
            
            const fileName = 'Ø·Ù„Ø¨Ø§Øª_Ù…Ø®ØªÙ„Ù.xlsx';
            
            const ordersData = allOrders.map((order, index) => {
                const customer = order.customer || {};
                const address = customer.address || {};
                const items = order.items || [];
                const discount = order.discount || {};
                const country = customer.country || address.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const currency = country === 'Ù…ØµØ±' ? 'Ø¬.Ù…' : 'Ø±.Ø³';
                
                let productSum = order.totals?.subtotal || 0;
                let productSumAfterDiscount = productSum - (discount.amount || 0);
                
                const shippingCost = order.shippingCost || 0;
                const totalRevenue = productSumAfterDiscount + shippingCost;
                
                const orderDate = new Date(order.createdAt);
                const formattedDate = orderDate.toLocaleDateString('ar-SA');
                const formattedTime = orderDate.toLocaleTimeString('ar-SA', { 
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return {
                    'Ù…': index + 1,
                    'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨': `#${order.orderNumber || order.id}`,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨': formattedDate,
                    'ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨': formattedTime,
                    'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„': customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±',
                    'Ø§Ù„Ù‡Ø§ØªÙ': customer.phone || '',
                    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': customer.email || '',
                    'Ø§Ù„Ø¯ÙˆÙ„Ø©': country,
                    'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': address.governorate || '',
                    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': address.city || '',
                    'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹': getPaymentMethodArabic(order.payment?.method),
                    'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹': order.paymentStatus === 'paid' ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹',
                    'Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨': order.status || 'Ø¬Ø¯ÙŠØ¯',
                    'Ù…Ù„Ø§Ø­Ø¸Ø§Øª': order.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯',
                    'ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…': discount.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
                    'Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…': discount.discountValue || discount.percentage || 0,
                    'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…': discount.amount || 0,
                    'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ': Math.round(productSum),
                    'Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…': Math.round(productSumAfterDiscount),
                    'Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†': shippingCost,
                    'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ': Math.round(totalRevenue),
                    'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª': items.length,
                };
            });
            
            const ws = XLSX.utils.json_to_sheet(ordersData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª');
            
            XLSX.writeFile(wb, fileName);
            
            showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel', 
                `ØªÙ… Ø­ÙØ¸ ${allOrders.length} Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ù…Ù„Ù:\nğŸ“‚ ${fileName}`,
                'success'
            );
        }

        // ========================= ğŸ”§ **Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚** =========================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
            
            if (checkAuth()) {
                console.log('âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                startAutoRefresh();
            } else {
                console.log('ğŸ‘¤ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                document.getElementById('loginScreen').style.display = 'flex';
            }
            
            setInterval(updateLastUpdateTime, 60000);
        });
    </script>
</body>
</html>
